<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>使用leaflet的第一天</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"
          integrity="sha512-xodZBNTC5n17Xt2atTPuE1HxjVMSvLVW9ocqUKLsCC5CXdbqCmblAshOMAS6/keqq/sMZMZ19scR4PsZChSR7A=="
          crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
            integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
            crossorigin=""></script>
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.js'></script>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.0.0/mapbox-gl.css' rel='stylesheet'/>
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.5.1.min.js"></script>

    <style>
        #mapid {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 100%;
        }
    </style>


</head>
<body>
<div id="mapid"></div>
<script>
    //点击地图任意位置，显示出当前位置的经纬度
    function onMapClick(e) {
        positionPopup
            .setLatLng(e.latlng)
            .setContent("你点击在了地图的 " + e.latlng.toString())
            .openOn(mymap);
    }

    //点击图中的台风点圈，显示相应的台风信息
    function circleClick(e) {
        var clickedCircle = e.target;
        clickedCircle.bindPopup(
            "<br>台风的信息:</br>" +
            "<br>位置：" + e.latlng + "</br>"
        ).openPopup();
    }

    //设置台风颜色
    function setTyphoonColor(typhoonPower) {
        switch (typhoonPower) {
            case 0:
                powerColor = 'blue';
                break;
            case 1:
                powerColor = 'green';
                break;
            case 2:
                powerColor = 'green';
                break;
            case 3:
                powerColor = 'yellow';
                break;
            case 4:
                powerColor = 'orange';
                break;
            case 5:
                powerColor = 'purple';
                break;
            case 6:
                powerColor = 'red';
                break;
            case 9:
                powerColor = 'black';
                break;
            default:
                powerColor = 'white';
                break;
        }
        return powerColor;
    }

    //地图初始化
    var mymap = L.map('mapid').setView([39.92, 116.46], 3);
    L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={accessToken}', {
        attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
        id: 'mapbox/streets-v11',
        tileSize: 512,
        zoomOffset: -1,
        accessToken: 'pk.eyJ1IjoiZHVhbnppaGFvIiwiYSI6ImNranZkNDZwNjA3dTIycG9hbjR6dGh5c3UifQ.ROEqcBmPSbuqfBW6AQZrYg'
    }).addTo(mymap);

    //这个数据以后需要使用json进行接受
    var Carmen_path = [
        {'lng': 139.9, 'lat': 5.7, 'date': 1949011300, 'power': 0},
        {'lng': 139.3, 'lat': 5.9, 'date': 1949011306, 'power': 0},
        {'lng': 138.7, 'lat': 6.3, 'date': 1949011312, 'power': 0},
        {'lng': 138.0, 'lat': 6.7, 'date': 1949011318, 'power': 0},
        {'lng': 137.3, 'lat': 7.2, 'date': 1949011400, 'power': 0},
        {'lng': 136.7, 'lat': 7.7, 'date': 1949011406, 'power': 0},
        {'lng': 136.0, 'lat': 8.2, 'date': 1949011412, 'power': 0},
        {'lng': 135.3, 'lat': 8.8, 'date': 1949011418, 'power': 0},
        {'lng': 134.8, 'lat': 9.6, 'date': 1949011500, 'power': 1},
        {'lng': 134.5, 'lat': 10.8, 'date': 1949011506, 'power': 2},
        {'lng': 134.5, 'lat': 11.6, 'date': 1949011512, 'power': 3},
        {'lng': 134.6, 'lat': 12.2, 'date': 1949011518, 'power': 3},
        {'lng': 134.7, 'lat': 12.7, 'date': 1949011600, 'power': 3},
        {'lng': 135.1, 'lat': 13.1, 'date': 1949011606, 'power': 4},
        {'lng': 135.3, 'lat': 13.2, 'date': 1949011612, 'power': 4},
        {'lng': 135.6, 'lat': 13.2, 'date': 1949011618, 'power': 4},
        {'lng': 135.9, 'lat': 13.1, 'date': 1949011700, 'power': 4},
        {'lng': 136.1, 'lat': 12.8, 'date': 1949011706, 'power': 4},
        {'lng': 135.9, 'lat': 12.6, 'date': 1949011712, 'power': 4},
        {'lng': 135.6, 'lat': 12.4, 'date': 1949011718, 'power': 5},
        {'lng': 135.2, 'lat': 12.3, 'date': 1949011800, 'power': 5},
        {'lng': 134.5, 'lat': 12.4, 'date': 1949011806, 'power': 5},
        {'lng': 133.8, 'lat': 12.4, 'date': 1949011812, 'power': 5},
        {'lng': 132.8, 'lat': 12.3, 'date': 1949011818, 'power': 4},
        {'lng': 131.8, 'lat': 12.2, 'date': 1949011900, 'power': 3},
        {'lng': 130.9, 'lat': 12.1, 'date': 1949011906, 'power': 3},
        {'lng': 129.9, 'lat': 11.9, 'date': 1949011912, 'power': 2},
        {'lng': 129.1, 'lat': 11.7, 'date': 1949011918, 'power': 2},
        {'lng': 128.2, 'lat': 11.6, 'date': 1949012000, 'power': 1},
        {'lng': 127.4, 'lat': 11.4, 'date': 1949012006, 'power': 1},
        {'lng': 126.6, 'lat': 11.3, 'date': 1949012012, 'power': 0},
        {'lng': 125.7, 'lat': 11.2, 'date': 1949012018, 'power': 0},
        {'lng': 124.9, 'lat': 11.3, 'date': 1949012100, 'power': 0},
        {'lng': 124.3, 'lat': 11.4, 'date': 1949012106, 'power': 0},
        {'lng': 123.8, 'lat': 11.6, 'date': 1949012112, 'power': 0},
        {'lng': 123.3, 'lat': 11.7, 'date': 1949012118, 'power': 0},
        {'lng': 122.7, 'lat': 11.9, 'date': 1949012200, 'power': 0},
        {'lng': 122.2, 'lat': 12.0, 'date': 1949012206, 'power': 0},
        {'lng': 121.2, 'lat': 12.5, 'date': 1949012212, 'power': 0},
        {'lng': 120.0, 'lat': 13.3, 'date': 1949012218, 'power': 0},
        {'lng': 119.4, 'lat': 13.8, 'date': 1949012300, 'power': 0},
        {'lng': 119.1, 'lat': 14.3, 'date': 1949012306, 'power': 0},
        {'lng': 118.7, 'lat': 14.7, 'date': 1949012312, 'power': 0},
        {'lng': 118.4, 'lat': 15.2, 'date': 1949012318, 'power': 0},
        {'lng': 118.2, 'lat': 15.7, 'date': 1949012400, 'power': 0},
        {'lng': 117.9, 'lat': 16.1, 'date': 1949012406, 'power': 0},
        {'lng': 117.7, 'lat': 16.6, 'date': 1949012412, 'power': 0},
        {'lng': 117.4, 'lat': 17.1, 'date': 1949012418, 'power': 0},
        {'lng': 117.3, 'lat': 17.5, 'date': 1949012500, 'power': 0},
    ];
    //台风点序列：用于存储台风的相关信息，由于leaflet很多传参不好实现，使用全局变量的方式进行变量的读取
    var pointList = [];
    //对台风数据中的每个点都在地图上进行设置
    for (var i = 0; i < Carmen_path.length; i++) {
        var power = Carmen_path[i].power;
        var time = Carmen_path[i].date;
        var powercolor = setTyphoonColor(Carmen_path[i].power);
        var circle = L.circle([Carmen_path[i].lat, Carmen_path[i].lng], 30000, {
            color: powercolor,
            fillColor: powercolor,
            fillOpacity: 0.5,
            radius: 500
        }).addTo(mymap).on("click", function (e) {
            var clickedCircle = e.target;
            clickedCircle.bindPopup(
                "<br>台风的信息:</br>" +
                "<br>位置：" + e.latlng + "</br>"+
                "<br>时间：" + time + "</br>"+
                "<br>强度：" + power + "</br>"
            ).openPopup();
        });
        var point = {
            index: i,
            _circle: circle,
            _time: Carmen_path[i].date,
            _power: Carmen_path[i].power
        };
        pointList.push(point);
        //向地图中画线
        if (i !== 0) {
            var polygon = L.polygon([
                    [Carmen_path[i].lat, Carmen_path[i].lng],
                    [Carmen_path[i - 1].lat, Carmen_path[i - 1].lng]
                ],
                {
                    color: 'black'
                }).addTo(mymap);
        }
    }

    //在页面上添加点击动作
    var positionPopup = L.popup();
    mymap.on('click', onMapClick);

</script>
</body>
</html>